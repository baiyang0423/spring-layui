
<style>
    .layui-layedit{
        height: 500px;
    }
    .layui-div-text{
        width: 800px;

    }
    .layui-inline{
        padding-top: 10px;
    }
    .layui-card-header{
        background-color: white;
    }
    .layui-div-text{
        width: 1100px;
    }

</style>


<div class="email-btn-div">

</div>

<div class="layui-card" >
    <div class="layui-card-body">
        <form class="layui-form">

            <button type="button" lay-submit lay-filter="lay-email-send" class="layui-btn" id="lay-email-send">发送</button>
            <button type="button" lay-submit lay-filter="lay-email-save" class="layui-btn layui-btn-normal">存草稿</button>
            <div style="width: 80%;padding-left: 50px;padding-top: 20px">

                <div class="layui-inline layui-col-lg12">
                    <label>收件人：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="touser" placeholder="请输入收件人，多个用 ；隔开！" class="layui-input layui-div-text">
                    </div>
                </div>
                <div class="layui-inline layui-col-lg12">
                    <label>主&emsp;题：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="subject" placeholder="请输入主题！" class="layui-input layui-div-text">
                    </div>
                </div>
                <div style="padding-bottom: 20px;">
                    <span>添加附件：</span>
                </div>

                <div style="background-color: white;">
                    <textarea id="layeditDemo" style="height: 500px;"></textarea>
                </div>
            </div>
        </form>

    </div>
</div>




<script>
    layui.use(['layedit', 'form', 'jquery'], function () {

        var $ = layui.jquery,layedit = layui.layedit , form = layui.form;

        layedit.set({
            //暴露layupload参数设置接口 --详细查看layupload参数说明
            uploadImage: {
                url: '/web-top/manager/user/person/file/upload',
                accept: 'image',
                acceptMime: 'image/*',
                exts: 'jpg|png|gif|bmp|jpeg',
                size: '10240'
            }
            , uploadVideo: {
                url: '/Attachment/LayUploadFile',
                accept: 'video',
                acceptMime: 'video/*',
                exts: 'mp4|flv|avi|rm|rmvb',
                size: '20480'
            }
            //右键删除图片/视频时的回调参数，post到后台删除服务器文件等操作，
            //传递参数：
            //图片： imgpath --图片路径
            //视频： filepath --视频路径 imgpath --封面路径
            , calldel: {
                url: '/Attachment/DeleteFile'
            }
            //开发者模式 --默认为false
            , devmode: true
            //插入代码设置
            , codeConfig: {
                hide: true,  //是否显示编码语言选择框
                default: 'javascript' //hide为true时的默认语言格式
            }
            , tool: [
                'code', 'strong', 'italic', 'underline', 'del', 'addhr', '|', 'fontFomatt', 'colorpicker', 'face'
                , '|', 'left', 'center', 'right', '|', 'link', 'unlink', 'image_alt', 'video', 'anchors'
            ]
            , height: '90%'
        });
        var ieditor = layedit.build('layeditDemo');

        //发送邮件按钮
        form.on('submit(lay-email-send)',function(){
            var content = layedit.getContent(ieditor);


            console.info(content);

            var param = {
                to : $("input[name='touser']").val(),
                subject : $("input[name='subject']").val(),
                content : content
            }

            $.ajax({
                url:"/web-top/email/send",
                type:'post',
                data:JSON.stringify(param),
                contentType: 'application/json',
                beforeSend:function () {
                    this.layerIndex = layer.load(1, { shade: [0.1,'#fff'] });
                },
                success:function(data){
                    if(data.code == '0'){
                        layer.msg("邮件已发送", {
                            icon: 6,//成功的表情
                            time: 1000 //1秒关闭（如果不配置，默认是3秒）
                        });
                    }else{
                        layer.msg(data.msg,{icon: 5});//失败的表情
                        return;
                    }
                },
                complete: function () {
                    layer.close(this.layerIndex);
                },
            });
        })


        //保存草稿
        form.on('submit(lay-email-save)',function(){

        })




    })
</script>