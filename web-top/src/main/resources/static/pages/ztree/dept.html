


<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-col-xs12">
            <div class="layui-card">
                <!-- layui-card-header -->
                <div class="layui-form layui-card-header layuiadmin-card-header-auto" style="height: 60px;">
                    <div class="layui-form-item"  style="padding-top: 10px;">
                        <div class="layui-inline">
                            <label class="layui-form-label">标题：</label>
                            <div class="layui-input-inline">
                                <input type="text" name="title" placeholder="请输入" autocomplete="off" class="layui-input">
                            </div>
                            <label class="layui-form-label">创建时间：</label>
                            <div class="layui-input-inline">
                                <input type="text" name="startTime" id="lay-startTime" idex placeholder="yyyy-MM-dd HH:mm:ss" class="layui-input">
                            </div> -
                            <div class="layui-input-inline">
                                <input type="text" name="endTime" id="lay-endTime" placeholder="yyyy-MM-dd HH:mm:ss" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn layuiadmin-btn-comm" data-type="reload" lay-submit lay-filter="lay-user-search">
                                <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- layui-card-body  -->
                <div class="layui-card-body">
                    <div class="layui-col-lg3">
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                            <legend>组织管理</legend>
                        </fieldset>
                        <div id="dept-tree" class="demo-tree-more" style="margin-left: -13px;height: 510px;"></div>
                    </div>
                    <div class="layui-col-lg9 lay-tree-div" style="padding-left: 20px ;">

                        <table class="layui-table" id="functionList" lay-filter="functionList"></table>
                    </div>

                    <script type="text/html" id="toolbarDemo">
                        <div class="layui-btn-container">
                            <button class="layui-btn layui-btn-sm" lay-event="setAdd">新增菜单</button>
                        </div>
                    </script>

                    <script type="text/html" id="barDemo">
                        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                    </script>

                </div>
            </div>
        </div>
    </div>
</div>


<script>
    layui.use(['table','layer','jquery','form','laydate','tree'], function(){
        var table = layui.table , layer = layui.layer , $ = layui.jquery
            , form = layui.form ,laydate = layui.laydate ,tree = layui.tree
            //模拟数据
            ,data = [{
                title: '一级1'
                ,id: 1
                ,field: 'name1'
                ,checked: true
                ,spread: true
                ,children: [{
                    title: '二级1-1 可允许跳转'
                    ,id: 3
                    ,field: 'name11'
                    ,href: 'https://www.layui.com/'
                    ,children: [{
                        title: '三级1-1-3'
                        ,id: 23
                        ,field: ''
                        ,children: [{
                            title: '四级1-1-3-1'
                            ,id: 24
                            ,field: ''
                            ,children: [{
                                title: '五级1-1-3-1-1'
                                ,id: 30
                                ,field: ''
                            },{
                                title: '五级1-1-3-1-2'
                                ,id: 31
                                ,field: ''
                            }]
                        }]
                    },{
                        title: '三级1-1-1'
                        ,id: 7
                        ,field: ''
                        ,children: [{
                            title: '四级1-1-1-1 可允许跳转'
                            ,id: 15
                            ,field: ''
                            ,href: 'https://www.layui.com/doc/'
                        }]
                    },{
                        title: '三级1-1-2'
                        ,id: 8
                        ,field: ''
                        ,children: [{
                            title: '四级1-1-2-1'
                            ,id: 32
                            ,field: ''
                        }]
                    }]
                },{
                    title: '二级1-2'
                    ,id: 4
                    ,spread: true
                    ,children: [{
                        title: '三级1-2-1'
                        ,id: 9
                        ,field: ''
                        ,disabled: true
                    },{
                        title: '三级1-2-2'
                        ,id: 10
                        ,field: ''
                    }]
                },{
                    title: '二级1-3'
                    ,id: 20
                    ,field: ''
                    ,children: [{
                        title: '三级1-3-1'
                        ,id: 21
                        ,field: ''
                    },{
                        title: '三级1-3-2'
                        ,id: 22
                        ,field: ''
                    }]
                }]
            },{
                title: '一级2'
                ,id: 2
                ,field: ''
                ,spread: true
                ,children: [{
                    title: '二级2-1'
                    ,id: 5
                    ,field: ''
                    ,spread: true
                    ,children: [{
                        title: '三级2-1-1'
                        ,id: 11
                        ,field: ''
                    },{
                        title: '三级2-1-2'
                        ,id: 12
                        ,field: ''
                    }]
                },{
                    title: '二级2-2'
                    ,id: 6
                    ,field: ''
                    ,children: [{
                        title: '三级2-2-1'
                        ,id: 13
                        ,field: ''
                    },{
                        title: '三级2-2-2'
                        ,id: 14
                        ,field: ''
                        ,disabled: true
                    }]
                }]
            },{
                title: '一级3'
                ,id: 16
                ,field: ''
                ,children: [{
                    title: '二级3-1'
                    ,id: 17
                    ,field: ''
                    ,fixed: true
                    ,children: [{
                        title: '三级3-1-1'
                        ,id: 18
                        ,field: ''
                    },{
                        title: '三级3-1-2'
                        ,id: 19
                        ,field: ''
                    }]
                },{
                    title: '二级3-2'
                    ,id: 27
                    ,field: ''
                    ,children: [{
                        title: '三级3-2-1'
                        ,id: 28
                        ,field: ''
                    },{
                        title: '三级3-2-2'
                        ,id: 29
                        ,field: ''
                    }]
                }]
            }];




        //初始化日期
        //日期时间选择器
        laydate.render({
            elem: '#lay-startTime'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#lay-endTime'
            ,type: 'datetime'
            // ,range: true //时间范围
            ,format: 'yyyy年MM月dd日' //自定义展示格式
            ,calendar: true  //开启公历节日
            ,theme: '#393D49' //自定义颜色
        });

        //初始化表格
        table.render({
            elem: '#functionList'
            ,url:'/web-top/sys/function/select/page'
            ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
            ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                title: '提示'
                ,layEvent: 'LAYTABLE_TIPS'
                ,icon: 'layui-icon-tips'
            }]
            ,title: '用户数据表'
            ,page: true
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [[
                {type: 'checkbox', fixed: 'left'}
                ,{field:'id', width:80, title: 'ID'}
                ,{field:'title', width:100, title: '标题'}
                ,{field:'code', width:80, title: '代码'}
                ,{field:'url', width:100,  width: '30%',title: '路径'}
                ,{field:'path', title: '地址', minWidth: 100} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
                ,{field:'icon', width: '5%', title: '图标'}
                ,{field:'lev', width: '5%', title: '等级'}
                ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
            ]]
            ,where:{  "title":""  }
            , done: function (res) {
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
            }
        });

        //监听搜索
        form.on('submit(lay-user-search)', function(data){
            var field = data.field;
            //表格执行重载
            table.reload('functionList', {
                page: {curr: 1 }
                ,where: field
            });
        });


        //初始化ztree
        tree.render({
            elem: '#dept-tree'
            ,data: data
            ,showCheckbox: true  //是否显示复选框
            ,id: 'demoId1'
            ,isJump: true //是否允许点击节点时弹出新窗口跳转
            ,click: function(obj){
                var data = obj.data;  //获取当前点击的节点数据
                layer.msg('状态：'+ obj.state + '<br>节点数据：' + JSON.stringify(data));
            }
        });

        //头工具栏事件
        table.on('toolbar(functionList)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'getCheckData':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'getCheckLength':
                    var data = checkStatus.data;
                    layer.msg('选中了：'+ data.length + ' 个');
                    break;
                case 'isAll':
                    layer.msg(checkStatus.isAll ? '全选': '未全选');
                    break;
                case 'setAdd':
                    showAdd();
                    break;

                //自定义头工具栏右侧图标 - 提示
                case 'LAYTABLE_TIPS':
                    layer.alert('这是工具栏右侧自定义的一个图标按钮');
                    break;
            };
        });


        //监听行工具事件
        table.on('tool(functionList)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    deleteUser(data);
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                showEdit(obj);
            }
        });


        //增加弹出层
        function showAdd () {
            layer.open({
                type: 2 //此处为iframe
                ,title: '新增用户'
                ,shade: 0
                ,offset: 'auto'
                ,anim: 5
                ,scrollbar: true
                ,btnAlign: 'c'
                ,area: ['1100px', '650px']
                ,content: '../home/ckplayer.html'
            });

        }

        //修改弹出层
        function showEdit(obj) {
            var data = obj.data;
            layer.open({
                id: 'edit_dialog'
                ,type: 2 //此处为iframe
                ,title: '修改用户'
                ,shade: 0
                ,offset: 'auto'
                ,anim: 5
                ,scrollbar: true
                ,btnAlign: 'c'
                ,area: ['1100px', '600px']
                ,content: '../auth/function/edit.html?id='+data.id
            });
        }


        function deleteUser(data) {
            $.ajax({
                url:"/web-top/sys/user/delete",
                type:'post',
                data:JSON.stringify(data),
                contentType: 'application/json',
                beforeSend:function () {
                    this.layerIndex = layer.load(0, { shade: [0.5, '#393D49'] });
                },
                success:function(data){
                    if(data.code == '0'){
                        layer.msg(data.msg, {
                            icon: 6,//成功的表情
                            time: 1000 //1秒关闭（如果不配置，默认是3秒）
                        }, function(){
                            // location.reload();
                        });
                    }else{
                        layer.msg(data.msg,{icon: 5});//失败的表情
                        return;
                    }
                },
                complete: function () {
                    layer.close(this.layerIndex);
                },
            });
        }



    });

</script>
<style scoped>

</style>